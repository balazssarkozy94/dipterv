%----------------------------------------------------------------------------
\chapter{C-RTU család}
%----------------------------------------------------------------------------

\begin{figure}[!ht]
\centering
\includegraphics[width=100mm, keepaspectratio]{figures/2_1_0_CRTU_FAMILY.png}
\caption{C-RTU család}
\end{figure}

A PROLAN Zrt. C-RTU családjával kisméretû, moduláris adatgyûjtõ és vezérlõ rendszereket lehet kialakítani. Az alapkészülék mellé számos kiegészítõ modul áll rendelkezésre, melyek között CAN kommunikációval történik az adatcsere egy moduláris hátlapi buszon keresztül. Ezek a modulok lehetnek például: digitális be- és kimenetek, feszültség és árammérõk, tápkimaradás áthidaló okos tápegységek, különbözõ kommunikációs interfészt biztosító kiegészítõk vagy akár elektromos jármû töltés vezérlõk. A legtöbb kiegészítõ modulban lévõ, helyi mikrokontroller a Linux operációs rendszert futtató C-RTU alapkészülékkel CAN buszon kommunikál. A kontroller látja el a modul specifikus feladatokat, az alapkészüléknek már csak a magasabb szintû logikát, feldolgozást kell megvalósítania Linux operációs rendszer alól. 

%----------------------------------------------------------------------------
\section{Alapkészülék}
%----------------------------------------------------------------------------

\begin{figure}[!ht]
\centering
\includegraphics[width=100mm, keepaspectratio]{figures/2_1_1_crtu_alap.png}
\caption{C-RTU alapkészülék}
\end{figure}

TODO CITÁCIÓ NXP, KARO, PROLAN!

Az alapkészülékben egy Ka-Ro electronics GmbH által gyártott ''Computer-On-Module'' található, ez a processzor egy-egy C-RTU alkalmazásnak a lelke. A modulon az NXP i.MX 6UltraLite MCIMX6G2-es processzora van, ez egy alacsony fogyasztású alkalmazás processzor. Emellé a modulon 4GiB eMMC társul, továbbá 256MiB SDRAM, valamint egy komplex tápáramkör, aminek már csak egy bemeneti feszültségre van szüksége a mûködéshez.

Az alapkészülék egy 4 modulhely (71.6mm) széles készülékházban kapott helyet. Több szoftveresen választható helyi, külsõ kommunikációs vonal is használható. A lehetséges konfigurációk: RS422, vagy 2 RS485 vonal, vagy egy RS485 és egy CAN busz. Hardveresen vezeték nélküli opciók közül választhatunk 2G/3G/4G GSM, vagy LTE 450, vagy LoRa kommunikációból, illetve ezek helyett optikai Ethernetet. Mindegyik alapkészülékben van továbbá egy réz alapú Ethernet port is.

%----------------------------------------------------------------------------
\section{Kiegészítõ modulok}
%----------------------------------------------------------------------------

A kiegészítõ modulok adják a C-RTU rendszerek flexibilitását, az alapkészülék mellé mindig csak az éppen szükséges ki- és bemenetek kerülnek, ezzel minimalizálva a helyigényt, költségeket.

A kommunikáció az alapkészülék és modulok között egy CAN alapú, belsõ fejlesztésû C-CAN elnevezésû kommunikációval történik, ez speciális címzéseket és csomag típusokat definiál, egy masteres topológiával.

A modulok elõlapján kötelezõ elhelyezni egy címbeállító dil switchet, amely segítségével a C-CAN címét tudjuk beállítani a modulnak, indulás után ez alapján tudja a modul, hogy mely üzenetek vonatkoznak rá. Az összes kiegészítõ készülék, amely valamilyen mikrokontrollert tartalmaz, egy bootloader futtatásával indul, az alapkészülék ezen keresztül tudja akár távolról is frissíteni a firmware-t.

A modulok indulás után egy paraméterezõ fázisba kerülnek, ahol az alapkészülék a futásukhoz szükséges adatokat átadja. Ezt követõen a kiegészítõ készülékek életjelet küldenek, valamint a paramétereknek megfelelõen adatokat. A különbözõ adatokat kétféleképpen küldhetik fel az alapkészüléknek:

\begin{enumerate}
\item\emph{Ciklusidõ alapján:} Elõre beállított idõnként a modul elküldi a figyelt változót, annak értékének változásától függetlenül. 
\item\emph{Szignifikancia alapján:} Egy beállított különbséghatárérték átlépése esetén a változó új értékét elküldi az alapkészüléknek, majd onnantól kezdve ezt az új értéket veszi alapnak a változások figyelésénél.
\end{enumerate}

A két változás figyelési módszer egyszerre is alkalmazható, ilyenkor mindig az éppen hamarabb bekövetkezõ kritérium alapján történik a felküldés.

TODO LEDEK, KÖZÖS KÖTELEZÕ FUNKCIÓK 

%----------------------------------------------------------------------------
\section{Mechanikai kialakítás}
%----------------------------------------------------------------------------

A C-RTU család eszközeit a Phoenix Contact BC moduláris készülékházait használják. Ezek kalapsínre szerelhetõk, illetve több méretben is elérhetõk.  A nyomtatott áramköri lapok elhelyezése számos módon történhet, az megoldható akár vízszintesen, akár függõlegesen. A sok rögzítési pont következtében kis kiterjedésû modulokat lehet létrehozni az úgynevezett ''szendvics panel'' kialakítással. A C-RTU családban modulonként általában 2 emelet van, illetve ezen felül egy, ami a készülék elõlapját valósítja meg. Az elõlap NYÁK-ból való megvalósítása elõször pazarlónak gondolhatnánk, azonban nagy gyártási darabszámnál nem emeli jelentõs mértékben a költségeket, emellett könnyû gyártani, konzisztens és szép eredményt nyújt a sztenderd 0.15/0.15mm-es vezetõ/szigetelõ technológiával. További elõnye a megoldásnak, hogy a felhasználó által nem látható, belsõ oldalra alkatrészek ültethetõek. Ez például a C-RTU alapkészüléknél ki van használva, ott két antennacsatlakozó kerül beültetésre igény szerint, amelyek mögött a réz rajzolaton egy-egy NYÁK antenna került elhelyezésre, így amennyiben a felhasználsái területre elég egy kisebb nyereségû antenna, a felhasználók plusz költség nélkül hozzáférnek ezekhez.

TODO